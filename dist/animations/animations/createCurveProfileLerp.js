import{n as A,L as d,U as I,i as f,W as R}from"./makeScene2D.js";function V(n,o,t){const s={arcLength:0,segments:[],minSin:1};if(n.length===0)return s;if(t){const i=n[0].add(n[n.length-1]).scale(.5);n=[i,...n,i]}let e=n[0];for(let i=2;i<n.length;i++){const r=n[i-2],l=n[i-1],a=n[i],y=r.sub(l),M=a.sub(l),g=y.normalized.safe,u=M.normalized.safe,w=Math.acos(A(-1,1,g.dot(u))),h=Math.tan(w/2),m=Math.sin(w/2),p=Math.min(o,h*y.magnitude*(i===2?1:.5),h*M.magnitude*(i===n.length-1?1:.5)),x=m===0?0:p/m,D=h===0?0:p/h,z=g.add(u).scale(1/2).normalized.safe.scale(x).add(l),P=g.perpendicular.dot(u)<0,b=new d(e,l.add(g.scale(D))),L=new I(z,p,g.perpendicular.scale(P?1:-1),u.perpendicular.scale(P?-1:1),P);b.arcLength>0&&(s.segments.push(b),s.arcLength+=b.arcLength),L.arcLength>0&&(s.segments.push(L),s.arcLength+=L.arcLength),s.minSin=Math.min(s.minSin,Math.abs(m)),e=l.add(u.scale(D))}const c=new d(e,n[n.length-1]);return c.arcLength>0&&(s.segments.push(c),s.arcLength+=c.arcLength),s}function B(n,o){for(let t=0;t<n.length-1;t++){const s=n[t];let e=n[t+1];for(;s.sub(e).magnitude>o;)e=f.lerp(s,e,.5),n.splice(t+1,0,e)}}function E(n,o){const t=[];let s=null;for(const e of n.segments){if(!(e instanceof d))return null;t.push(e.from),s=e.to}return s&&t.push(s),!Number.isNaN(o)&&o>0&&B(t,o),t}function U(n){return n.reduce((o,t,s)=>{const e=n[(s+1)%n.length];return o+(t.y*e.x-t.x*e.y)},0)/2}function W(n,o){const t=[];let s=3;!Number.isNaN(o)&&o>0&&(s=Math.max(s,Math.ceil(n.arcLength/o)));for(let e=0;e<s;e+=1){const c=R(n,n.arcLength*(e/(s-1)));t.push(c.position)}return U(t)>0&&t.reverse(),t}function N(n){if(n.segments.length===0)return[];let o={arcLength:0,minSin:0,segments:[],closed:!1},t=null;const s=[o];for(const e of n.segments){const c=e.getPoint(0).position;t&&!c.equals(t)&&(o={arcLength:0,minSin:0,segments:[],closed:!1},s.push(o)),o.segments.push(e),o.arcLength+=e.arcLength,t=e.getPoint(1).position}for(const e of s)e.closed=e.segments[0].getPoint(0).position.equals(e.segments[e.segments.length-1].getPoint(1).position);return s}function v(n,o){return{points:[...E(n,o)||W(n,o)],closed:n.closed}}function j(n){return n.reduce((o,t,s)=>s?o+n[s-1].sub(t).magnitude:0,0)}function C(n,o){const t=n.length+o,s=j(n)/o;let e=0,c=0,i=s/2;for(;n.length<t;){const r=n[e],l=n[(e+1)%n.length],a=r.sub(l).magnitude;i<=c+a?(n.splice(e+1,0,a?f.lerp(r,l,(i-c)/a):new f(r)),i+=s):(c+=a,e+=1)}}function S(n,o,t){const s=n.length;let e=0;for(let c=0;c<o.length;c+=1){const i=n[(t+c)%s],r=o[c];e+=i.sub(r).squaredMagnitude}return e}function T(n,o){const{points:t,closed:s}=n,e=t.length;if(s){let c=1/0,i=0;const r=t.pop();for(let l=0;l<e;l+=1){const a=S(t,o.points,l);a<c&&(c=a,i=l)}if(r&&t.push(r),i){t.pop();const l=t.splice(0,i);t.splice(t.length,0,...l),t.push(t[0])}}else{const c=S(t,o.points,0),i=[...t].reverse();S(i,o.points,0)<c&&(n.points=i)}}function q({points:n,...o},t){const s=t>=1?10**t:1;return{points:n.map(e=>{const[c,i]=[e.x,e.y].map(r=>Math.round(r*s)/s);return new f(c,i)}),...o}}function k(n,o,t,s){const e=t,c=v(n,e),i=v(o,e),r=c.points.length-i.points.length;return C(c.points,r<0?r*-1:0),C(i.points,r>0?r:0),!n.closed&&o.closed?T(i,c):T(c,i),{from:q(c,s),to:q(i,s)}}function O(n,o){for(let t=n.length;t<o.length;t++){const s=o[t].segments[0].getPoint(0).position;n.push({arcLength:0,closed:!1,minSin:0,segments:[new d(s,s)]})}}function F(n,o,t,s){const e=N(n),c=N(o);return e.length<c.length?O(e,c):O(c,e),e.map((i,r)=>k(i,c[r],t,s))}function G(n,o){const{segments:t,arcLength:s,minSin:e}=o;n.segments.push(...t),n.arcLength+=s,n.minSin=Math.min(n.minSin,e)}function H(n,o,t){const s=[];if(t===0)return[...n];if(t===1)return[...o];for(let e=0;e<n.length;e++){const c=n[e],i=o[e];s.push(f.lerp(c,i,t))}return s}function K(n,o){const t=F(n,o,5,4);return s=>{const e={segments:[],arcLength:0,minSin:1};for(const{from:c,to:i}of t){const r=H(c.points,i.points,s);G(e,V(r,0,!1))}return e}}export{S as a,H as b,K as c,V as g,j as p};
